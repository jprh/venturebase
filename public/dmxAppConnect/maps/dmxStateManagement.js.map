{"version":3,"sources":["components/queryManager.js","components/cookieManager.js","components/localManager.js","components/sessionManager.js"],"names":["dmx","Component","initialData","data","methods","set","key","value","this","setQueryParam","remove","removeAll","render","node","search","window","location","updateData","bind","addEventListener","parseQuery","updated","params","clone","URLSearchParams","url","URL","history","pushState","pathname","buildQuery","hash","keys","Object","length","reduce","query","encodeURIComponent","replace","split","part","p","decodeURIComponent","cookie","document","getCookie","name","options","setCookie","expires","forEach","pos","indexOf","substr","test","path","String","escape","Date","now","toUTCString","domain","secure","val","JSON","stringify","localStorage","setItem","removeItem","getData","startsWith","parse","getItem","e","console","warn","sessionStorage"],"mappings":";;;;;;AAAAA,IAAAC,UAAA,gBAAA,CAEAC,YAAA,CACAC,KAAA,CAAA,GAGAC,QAAA,CACAC,IAAA,SAAAC,EAAAC,GACAC,KAAAC,cAAAH,EAAAC,EACA,EAEAG,OAAA,SAAAJ,GACAE,KAAAC,cAAAH,EACA,EAEAK,UAAA,WACAH,KAAAC,eACA,GAGAG,OAAA,SAAAC,GACAL,KAAAM,OAAAC,OAAAC,SAAAF,OACAN,KAAAS,WAAAT,KAAAS,WAAAC,KAAAV,MAEAO,OAAAI,iBAAA,WAAAX,KAAAS,YACAF,OAAAI,iBAAA,YAAAX,KAAAS,YACAF,OAAAI,iBAAA,eAAAX,KAAAS,YACAT,KAAAS,YACA,EAEAA,WAAA,WACAT,KAAAM,SAAAC,OAAAC,SAAAF,SACAN,KAAAM,OAAAC,OAAAC,SAAAF,OACAN,KAAAH,IAAA,OAAAG,KAAAY,cAEA,EAEAX,cAAA,SAAAH,EAAAC,GACA,IAAAc,GAAA,EACAC,EAAAtB,IAAAuB,MAAAf,KAAAL,KAAAA,MAeA,GAbA,MAAAI,EACA,MAAAD,GACAgB,EAAA,CAAA,EACAD,GAAA,GACAC,EAAAhB,YACAgB,EAAAhB,GACAe,GAAA,GAEAC,EAAAhB,IAAAC,IACAe,EAAAhB,GAAAC,EACAc,GAAA,GAGAA,EACA,GAAAN,OAAAS,gBAAA,CACA,IAAAC,EAAA,IAAAC,IAAAX,OAAAC,UACAS,EAAAX,OAAA,IAAAU,gBAAAF,GACAP,OAAAY,QAAAC,UAAA,KAAA,KAAAH,EACA,MACAV,OAAAY,QAAAC,UAAA,KAAA,KAAAb,OAAAC,SAAAa,SAAArB,KAAAsB,WAAAR,GAAAP,OAAAC,SAAAe,KAGA,EAEAD,WAAA,SAAA3B,GACA,MAAA6B,EAAAC,OAAAD,KAAA7B,GAEA,OAAA6B,EAAAE,OAAA,IAAAF,EAAAG,QAAA,SAAAC,EAAA9B,GAGA,OAFA8B,IAAAA,GAAA,KACAA,GAAAC,mBAAA/B,GAAA,IAAA+B,mBAAAlC,EAAAG,GAEA,GAAA,IAAA,EACA,EAEAc,WAAA,WAGA,OAFAZ,KAAAM,OAAAwB,QAAA,MAAA,IAEAC,MAAA,KAAAJ,QAAA,SAAAhC,EAAAqC,GACA,MAAAC,EAAAD,EAAAF,QAAA,MAAA,KAAAC,MAAA,KAEA,OADAE,EAAA,KAAAtC,EAAAuC,mBAAAD,EAAA,KAAAC,mBAAAD,EAAA,IAAA,KACAtC,CACA,GAAA,CAAA,EACA,ICnFAH,IAAAC,UAAA,iBAAA,CAEAC,YAAA,WAGA,OAFAM,KAAAmC,OAAAC,SAAAD,OAEA,CACAxC,KAAAK,KAAAqC,YAEA,EAEAzC,QAAA,CACAC,IAAA,SAAAyC,EAAAvC,EAAAwC,GACAvC,KAAAwC,UAAAF,EAAAvC,EAAAwC,EACA,EAEArC,OAAA,SAAAoC,EAAAC,IACAA,EAAAA,GAAA,CAAA,GACAE,QAAA,uBACAzC,KAAAwC,UAAAF,EAAA,GAAAC,EACA,EAEApC,UAAA,SAAAoC,IACAA,EAAAA,GAAA,CAAA,GACAE,QAAA,uBACAhB,OAAAD,KAAAxB,KAAAL,KAAAA,MAAA+C,SAAA,SAAAJ,GACAtC,KAAAwC,UAAAF,EAAA,GAAAC,EACA,GACA,GAGAF,UAAA,WACA,OAAArC,KAAAmC,OAAAJ,MAAA,QAAAJ,QAAA,SAAAhC,EAAAwC,GACA,IAAAQ,EAAAR,EAAAS,QAAA,KAEA,OADAjD,EAAAuC,mBAAAC,EAAAU,OAAA,EAAAF,KAAAT,mBAAAC,EAAAU,OAAAF,EAAA,IACAhD,CACA,GAAA,CAAA,EACA,EAEA6C,UAAA,SAAAF,EAAAvC,EAAAwC,GACA,IAAAD,GAAA,6CAAAQ,KAAAR,GACA,OAAA,GAGAC,EAAAA,GAAA,CAAA,GACAQ,KAAAR,EAAAQ,MAAA,IAWA,IAAAZ,GALAG,GADAA,GADAA,EAAAT,mBAAAmB,OAAAV,KACAR,QAAA,2BAAAI,qBACAJ,QAAA,UAAAmB,SAKA,KAFAlD,GADAA,EAAA8B,mBAAAmB,OAAAjD,KACA+B,QAAA,4DAAAI,qBAIAK,EAAAE,UACA,iBAAAF,EAAAE,UACAF,EAAAE,QAAAS,KAAAC,MAAA,MAAAZ,EAAAE,SAEAN,GAAA,aAAA,IAAAe,KAAAX,EAAAE,SAAAW,eAGAb,EAAAc,SACAlB,GAAA,YAAAI,EAAAc,QAGAd,EAAAQ,OACAZ,GAAA,UAAAI,EAAAQ,MAGAR,EAAAe,SACAnB,GAAA,YAGAC,SAAAD,OAAAA,EAEAnC,KAAAmC,OAAAC,SAAAD,OACAnC,KAAAH,IAAA,OAAAG,KAAAqC,YACA,IChFA7C,IAAAC,UAAA,gBAAA,CAEAC,YAAA,CACAC,KAAA,CAAA,GAGAC,QAAA,CACAC,IAAA,SAAAC,EAAAC,GACA,MAAAwD,EAAAC,KAAAC,UAAA1D,GACA,MAAAwD,EACAhD,OAAAmD,aAAAC,QAAA,YAAA7D,EAAAyD,GAEAhD,OAAAmD,aAAAE,WAAA,YAAA9D,GAEAE,KAAA6D,SACA,EAEA3D,OAAA,SAAAJ,GACAS,OAAAmD,aAAAE,WAAA,YAAA9D,GACAE,KAAA6D,SACA,EAEA1D,UAAA,WACAsB,OAAAD,KAAAjB,OAAAmD,cAAAhB,SAAA,SAAA5C,GACAA,EAAAgE,WAAA,cACAvD,OAAAmD,aAAAE,WAAA9D,EAEA,IACAE,KAAA6D,SACA,GAGAzD,OAAA,SAAAC,GACAL,KAAA6D,SACA,EAEAA,QAAA,WACA7D,KAAAH,IAAA,OAAA4B,OAAAD,KAAAjB,OAAAmD,cAAA/B,QAAA,SAAAhC,EAAAG,GACA,GAAAA,EAAAgE,WAAA,aACA,IACAnE,EAAAG,EAAA+C,OAAA,IAAAW,KAAAO,MAAAxD,OAAAmD,aAAAM,QAAAlE,GACA,CAAA,MAAAmE,GACAC,QAAAC,KAAA,uBAAA5D,OAAAmD,aAAAM,QAAAlE,GACA,CAGA,OAAAH,CACA,GAAA,CAAA,GACA,IChDAH,IAAAC,UAAA,kBAAA,CAEAC,YAAA,CACAC,KAAA,CAAA,GAGAC,QAAA,CACAC,IAAA,SAAAC,EAAAC,GACA,MAAAwD,EAAAC,KAAAC,UAAA1D,GACA,MAAAwD,EACAhD,OAAA6D,eAAAT,QAAA,YAAA7D,EAAAyD,GAEAhD,OAAA6D,eAAAR,WAAA,YAAA9D,GAEAE,KAAA6D,SACA,EAEA3D,OAAA,SAAAJ,GACAS,OAAA6D,eAAAR,WAAA,YAAA9D,GACAE,KAAA6D,SACA,EAEA1D,UAAA,WACAsB,OAAAD,KAAAjB,OAAA6D,gBAAA1B,SAAA,SAAA5C,GACAA,EAAAgE,WAAA,cACAvD,OAAA6D,eAAAR,WAAA9D,EAEA,IACAE,KAAA6D,SACA,GAGAzD,OAAA,SAAAC,GACAL,KAAA6D,SACA,EAEAA,QAAA,WACA7D,KAAAH,IAAA,OAAA4B,OAAAD,KAAAjB,OAAA6D,gBAAAzC,QAAA,SAAAhC,EAAAG,GACA,GAAAA,EAAAgE,WAAA,aACA,IACAnE,EAAAG,EAAA+C,OAAA,IAAAW,KAAAO,MAAAxD,OAAA6D,eAAAJ,QAAAlE,GACA,CAAA,MAAAmE,GACAC,QAAAC,KAAA,uBAAA5D,OAAA6D,eAAAJ,QAAAlE,GACA,CAGA,OAAAH,CACA,GAAA,CAAA,GACA","file":"../dmxStateManagement/dmxStateManagement.js","sourcesContent":["dmx.Component('query-manager', {\r\n\r\n    initialData: {\r\n        data: {}\r\n    },\r\n\r\n    methods: {\r\n        set: function(key, value) {\r\n            this.setQueryParam(key, value);\r\n        },\r\n\r\n        remove: function(key) {\r\n            this.setQueryParam(key);\r\n        },\r\n\r\n        removeAll: function() {\r\n            this.setQueryParam();\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.search = window.location.search;\r\n        this.updateData = this.updateData.bind(this);\r\n        // only need to update on these events\r\n        window.addEventListener('popstate', this.updateData);\r\n        window.addEventListener('pushstate', this.updateData);\r\n        window.addEventListener('replacestate', this.updateData);\r\n        this.updateData();\r\n    },\r\n\r\n    updateData: function() {\r\n        if (this.search !== window.location.search) {\r\n            this.search = window.location.search;\r\n            this.set('data', this.parseQuery());\r\n        }\r\n    },\r\n\r\n    setQueryParam: function(key, value) {\r\n        let updated = false;\r\n        let params = dmx.clone(this.data.data);\r\n\r\n        if (value == null) {\r\n            if (key == null) {\r\n                params = {};\r\n                updated = true;\r\n            } else if (params[key]) {\r\n                delete params[key];\r\n                updated = true;\r\n            }\r\n        } else if (params[key] != value) {\r\n            params[key] = value;\r\n            updated = true;\r\n        }\r\n\r\n        if (updated) {\r\n            if (window.URLSearchParams) { // use URLSearchParams if available\r\n                var url = new URL(window.location);\r\n                url.search = new URLSearchParams(params);\r\n                window.history.pushState(null, null, url);\r\n            } else {    \r\n                window.history.pushState(null, null, window.location.pathname + this.buildQuery(params) + window.location.hash);\r\n            }\r\n        }\r\n    },\r\n\r\n    buildQuery: function(data) {\r\n        const keys = Object.keys(data);\r\n\r\n        return keys.length ? '?' + keys.reduce(function(query, key) {\r\n            if (query) query += '&';\r\n            query += encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);\r\n            return query;\r\n        }, '') : '';\r\n    },\r\n\r\n    parseQuery: function() {\r\n        const query = this.search.replace(/^\\?/, '');\r\n\r\n        return query.split('&').reduce(function(data, part) {\r\n            const p = part.replace(/\\+/g, ' ').split('=');\r\n            if (p[0]) data[decodeURIComponent(p[0])] = decodeURIComponent(p[1] || '');\r\n            return data;\r\n        }, {});\r\n    }\r\n\r\n});\r\n","dmx.Component('cookie-manager', {\r\n\r\n    initialData: function () {\r\n        this.cookie = document.cookie;\r\n\r\n        return {\r\n            data: this.getCookie()\r\n        };\r\n    },\r\n\r\n    methods: {\r\n        set: function(name, value, options) {\r\n            this.setCookie(name, value, options);\r\n        },\r\n\r\n        remove: function(name, options) {\r\n            options = options || {};\r\n            options.expires = '1970-01-01T00:00:00Z';\r\n            this.setCookie(name, '', options);\r\n        },\r\n\r\n        removeAll: function(options) {\r\n            options = options || {};\r\n            options.expires = '1970-01-01T00:00:00Z';\r\n            Object.keys(this.data.data).forEach(function(name) {\r\n                this.setCookie(name, '', options);\r\n            });\r\n        }\r\n    },\r\n\r\n    getCookie: function() {\r\n        return this.cookie.split(/;\\s*/).reduce(function(data, cookie) {\r\n            var pos = cookie.indexOf('=');\r\n            data[decodeURIComponent(cookie.substr(0, pos))] = decodeURIComponent(cookie.substr(pos + 1));\r\n            return data;\r\n        }, {})\r\n    },\r\n\r\n    setCookie: function(name, value, options) {\r\n        if (!name || /^(?:expires|max\\-age|path|domain|secure)$/i.test(name)) {\r\n            return false;\r\n        }\r\n\r\n        options = options || {};\r\n        options.path = options.path || '/';\r\n\r\n        // escaping taken from:\r\n        // https://github.com/js-cookie/js-cookie/blob/master/src/js.cookie.js\r\n        name = encodeURIComponent(String(name));\r\n\t\tname = name.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\r\n\t\tname = name.replace(/[\\(\\)]/g, escape);\r\n\r\n        value = encodeURIComponent(String(value));\r\n        value = value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\r\n\r\n        var cookie = name + '=' + value;\r\n\r\n        if (options.expires) {\r\n            if (typeof options.expires == 'number') {\r\n                options.expires = Date.now() + (options.expires * 86400000);\r\n            }\r\n            cookie += '; expires=' + (new Date(options.expires)).toUTCString();\r\n        }\r\n\r\n        if (options.domain) {\r\n            cookie += '; domain=' + options.domain;\r\n        }\r\n\r\n        if (options.path) {\r\n            cookie += '; path=' + options.path;\r\n        }\r\n\r\n        if (options.secure) {\r\n            cookie += '; secure';\r\n        }\r\n\r\n        document.cookie = cookie;\r\n\r\n        this.cookie = document.cookie;\r\n        this.set('data', this.getCookie());\r\n    }\r\n\r\n});\r\n","dmx.Component('local-manager', {\r\n\r\n    initialData: {\r\n        data: {}\r\n    },\r\n\r\n    methods: {\r\n        set: function(key, value) {\r\n            const val = JSON.stringify(value);\r\n            if (val != null) {\r\n                window.localStorage.setItem('dmxState-' + key, val);\r\n            } else {\r\n                window.localStorage.removeItem('dmxState-' + key);\r\n            }\r\n            this.getData();\r\n        },\r\n\r\n        remove: function(key) {\r\n            window.localStorage.removeItem('dmxState-' + key);\r\n            this.getData();\r\n        },\r\n\r\n        removeAll: function() {\r\n            Object.keys(window.localStorage).forEach(function(key) {\r\n                if (key.startsWith('dmxState-')) {\r\n                    window.localStorage.removeItem(key);\r\n                }\r\n            });\r\n            this.getData();\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.getData();\r\n    },\r\n\r\n    getData: function() {\r\n        this.set('data', Object.keys(window.localStorage).reduce(function(data, key) {\r\n            if (key.startsWith('dmxState-')) {\r\n                try {\r\n                    data[key.substr(9)] = JSON.parse(window.localStorage.getItem(key));\r\n                } catch (e) {\r\n                    console.warn('Error parsing JSON: ' + window.localStorage.getItem(key));\r\n                }\r\n            }\r\n\r\n            return data;\r\n        }, {}));\r\n    }\r\n\r\n});\r\n","dmx.Component('session-manager', {\r\n\r\n    initialData: {\r\n        data: {}\r\n    },\r\n\r\n    methods: {\r\n        set: function(key, value) {\r\n            const val = JSON.stringify(value);\r\n            if (val != null) {\r\n                window.sessionStorage.setItem('dmxState-' + key, val);\r\n            } else {\r\n                window.sessionStorage.removeItem('dmxState-' + key);\r\n            }\r\n            this.getData();\r\n        },\r\n\r\n        remove: function(key) {\r\n            window.sessionStorage.removeItem('dmxState-' + key);\r\n            this.getData();\r\n        },\r\n\r\n        removeAll: function() {\r\n            Object.keys(window.sessionStorage).forEach(function(key) {\r\n                if (key.startsWith('dmxState-')) {\r\n                    window.sessionStorage.removeItem(key);\r\n                }\r\n            });\r\n            this.getData();\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.getData();\r\n    },\r\n\r\n    getData: function() {\r\n        this.set('data', Object.keys(window.sessionStorage).reduce(function(data, key) {\r\n            if (key.startsWith('dmxState-')) {\r\n                try {\r\n                    data[key.substr(9)] = JSON.parse(window.sessionStorage.getItem(key));\r\n                } catch (e) {\r\n                    console.warn('Error parsing JSON: ' + window.sessionStorage.getItem(key));\r\n                }\r\n            }\r\n\r\n            return data;\r\n        }, {}));\r\n    }\r\n\r\n});\r\n"]}