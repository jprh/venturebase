{"version":3,"sources":["components/preloader.js"],"names":["dmx","Component","attributes","preview","type","Boolean","default","color","String","bgcolor","size","Number","spinner","methods","show","this","_show","hide","_hide","init","node","_checkLoaded","bind","_documentLoaded","_imagesLoaded","_dataLoaded","_spinners","rotatingPlane","doubleBounce","wave","wanderingCubes","pulse","chasingDots","threeBounce","circle","cubeGrid","fadingCircle","foldingCube","document","addEventListener","requestAnimationFrame","destroy","removeEventListener","render","props","classList","add","style","setProperty","innerHTML","Array","from","length","map","join","performUpdate","updatedProps","has","$node","removeProperty","body","_checkDocumentLoaded","_checkImagesLoaded","_checkDataLoaded","readyState","getElementsByTagName","every","img","complete","isListening","image","Image","src","_dataComponents","component","noload","data","_xhr","components","app","children","forEach","_getDataComponents","push"],"mappings":"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","file":"../dmxPreloader/dmxPreloader.js","sourcesContent":["dmx.Component('preloader', {\r\n\r\n  attributes: {\r\n    preview: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    color: {\r\n      type: String,\r\n      default: '#333',\r\n    },\r\n\r\n    bgcolor: {\r\n      type: String,\r\n      default: '#fff',\r\n    },\r\n\r\n    size: {\r\n      type: Number,\r\n      default: 60,\r\n    },\r\n\r\n    spinner: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    show () {\r\n      this._show();\r\n    },\r\n\r\n    hide () {\r\n      this._hide();\r\n    },\r\n  },\r\n\r\n  init (node) {\r\n    this._checkLoaded = this._checkLoaded.bind(this);\r\n\r\n    this._documentLoaded = false;\r\n    this._imagesLoaded = false;\r\n    this._dataLoaded = false;\r\n    this._spinners = {\r\n      rotatingPlane: 0,\r\n      doubleBounce: 2,\r\n      wave: 5,\r\n      wanderingCubes: 2,\r\n      pulse: 0,\r\n      chasingDots: 2,\r\n      threeBounce: 3,\r\n      circle: 12,\r\n      cubeGrid: 9,\r\n      fadingCircle: 12,\r\n      foldingCube: 4\r\n    };\r\n\r\n    document.addEventListener('readystatechange', this._checkLoaded);\r\n\r\n    requestAnimationFrame(() => {\r\n      this._checkLoaded();\r\n    });\r\n  },\r\n\r\n  destroy () {\r\n    document.removeEventListener('readystatechange', this._checkLoaded);\r\n  },\r\n\r\n  render (node) {\r\n    const { color, bgcolor, size, spinner } = this.props;\r\n\r\n    node.classList.add('dmxPreloader');\r\n    \r\n    node.style.setProperty('--color', color);\r\n    node.style.setProperty('--bgcolor', bgcolor);\r\n    node.style.setProperty('--size', size + 'px');\r\n\r\n    if (spinner) {\r\n      node.innerHTML = `\r\n        <div class=\"dmxPreloader-spinner dmxPreloader-${spinner}>\r\n          ${Array.from({ length: this._spinners[spinner] }).map(() => `\r\n            <div></div>\r\n          `).join('')}\r\n        <div>\r\n      `;\r\n    }\r\n\r\n    this._show();\r\n  },\r\n\r\n  performUpdate (updatedProps) {\r\n    if (updatedProps.has('color')) {\r\n      this.$node.style.setProperty('--color', this.props.color);\r\n    }\r\n\r\n    if (updatedProps.has('bgcolor')) {\r\n      this.$node.style.setProperty('--bgcolor', this.props.bgcolor);\r\n    }\r\n\r\n    if (updatedProps.has('size')) {\r\n      this.$node.style.setProperty('--size', this.props.size + 'px');\r\n    }\r\n  },\r\n\r\n  _show () {\r\n    this.$node.style.removeProperty('opacity');\r\n    this.$node.style.removeProperty('z-index');\r\n    document.body.style.setProperty('overflow', 'hidden');\r\n  },\r\n\r\n  _hide () {\r\n    this.$node.style.setProperty('opacity', 0);\r\n    this.$node.style.setProperty('z-index', -1);\r\n    document.body.style.removeProperty('overflow');\r\n  },\r\n\r\n  _checkLoaded () {\r\n    // When preview do nothing\r\n    if (this.props.preview) return;\r\n\r\n    this._checkDocumentLoaded();\r\n    this._checkImagesLoaded();\r\n    this._checkDataLoaded();\r\n\r\n    if (this._documentLoaded && this._imagesLoaded && this._dataLoaded) {\r\n      this._hide();\r\n    }\r\n  },\r\n\r\n  _checkDocumentLoaded () {\r\n    this._documentLoaded = (document.readyState === 'complete');\r\n  },\r\n\r\n  _checkImagesLoaded () {\r\n    this._imagesLoaded = Array.from(document.getElementsByTagName('img')).every(img => {\r\n      if (img.complete) return true;\r\n\r\n      if (!img.isListening) {\r\n        const image = new Image();\r\n        image.addEventListener('load', () => this._checkLoaded());\r\n        image.addEventListener('error', () => this._checkLoaded());\r\n        image.src = img.src;\r\n        img.isListening = true;\r\n      }\r\n\r\n      return false;\r\n    });\r\n  },\r\n\r\n  _checkDataLoaded () {\r\n    this._dataLoaded = this._dataComponents().every(component => {\r\n      return component.props.noload || component.data != null || (component._xhr && component._xhr.readyState === 4);\r\n    });\r\n  },\r\n\r\n  _dataComponents () {\r\n    const components = [];\r\n\r\n    dmx.app.children.forEach(function _getDataComponents(component) {\r\n      if (component instanceof dmx.Component('fetch')) {\r\n        components.push(component);\r\n      }\r\n\r\n      component.children.forEach(_getDataComponents);\r\n    });\r\n\r\n    return components;\r\n  }\r\n\r\n});\r\n"]}